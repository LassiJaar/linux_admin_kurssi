<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Yksinkertainen Keksiklikkeri</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#f6c85f;--muted:#94a3b8}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#071022 0%, #071533 100%);color:#e6eef8}
    .wrap{width:960px;max-width:96%;display:grid;grid-template-columns:420px 1fr;gap:24px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));padding:18px;border-radius:12px;box-shadow:0 6px 24px rgba(2,6,23,0.6)}
    .left{display:flex;flex-direction:column;align-items:center;gap:12px}
    .cookie{width:340px;height:340px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #ffd98a 0%, #f6c85f 35%, #d9a34a 60%, #b67a2b 100%);display:flex;align-items:center;justify-content:center;position:relative;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,0.6), inset 0 -20px 40px rgba(0,0,0,0.08)}
    .chip{width:28px;height:18px;background:#7b4514;border-radius:6px;position:absolute;transform:rotate(-12deg);box-shadow:inset 0 -2px 2px rgba(0,0,0,0.2)}
    .chip:nth-child(1){left:26%;top:32%}
    .chip:nth-child(2){left:54%;top:20%;transform:rotate(18deg)}
    .chip:nth-child(3){left:70%;top:52%;transform:rotate(-6deg)}
    .chip:nth-child(4){left:40%;top:62%;transform:rotate(-28deg)}
    .count{position:absolute;bottom:14px;left:14px;font-weight:700;color:#2b1b06;text-shadow:0 1px 0 rgba(255,255,255,0.2)}
    .big{font-size:20px}
    .stats{width:100%;display:flex;justify-content:space-between;padding:8px 6px;border-radius:8px;background:rgba(255,255,255,0.01);color:var(--muted)}
    .store{display:grid;gap:10px;margin-top:8px}
    .item{display:flex;justify-content:space-between;gap:12px;padding:12px;background:rgba(255,255,255,0.02);border-radius:8px;align-items:center}
    .btn{background:linear-gradient(180deg,#154a6f,#0b3550);border:none;color:white;padding:8px 12px;border-radius:8px;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .right{display:flex;flex-direction:column;gap:12px}
    h1{margin:0;font-size:20px}
  .toprow{display:flex;justify-content:space-between;align-items:center}
  .ai-notice{width:100%;padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(246,200,95,0.12), rgba(246,200,95,0.06));color:#fff7e6;font-size:13px;border:1px solid rgba(246,200,95,0.12);margin-bottom:8px}
    footer{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}
    @media (max-width:760px){.wrap{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel left">
      <div class="toprow" style="width:100%">
          <h1>Keksiklikkeri — Mini</h1>
          <div style="text-align:right;color:var(--muted)">Paina <kbd>Välilyönti</kbd> napsauttaaksesi</div>
        </div>
        <div class="ai-notice">Peli on luotu tekoälyn avulla. Tämä muokkaus on tehty ainoastaan osoittamaan, että sivua on muokattu.</div>

  <div class="cookie" id="cookie" title="Klikkaa minua!">
        <div class="chip"></div>
        <div class="chip"></div>
        <div class="chip"></div>
        <div class="chip"></div>
        <div class="count big" id="cookiesDisplay">0</div>
      </div>

      <div class="stats" style="margin-top:8px">
        <div>Keksit: <strong id="cookiesShort">0</strong></div>
        <div>KPS: <strong id="cps">0</strong></div>
        <div>Per napsautus: <strong id="cpc">1</strong></div>
      </div>

      <div style="width:100%;margin-top:10px">
        <div style="display:flex;gap:8px">
          <button class="btn" id="saveBtn">Tallenna</button>
          <button class="btn secondary" id="resetBtn">Nollaa</button>
        </div>
        <footer>Tallentaa automaattisesti 5s välein. Yksinkertainen demo — ei ulkoisia kirjastoja.</footer>
      </div>
    </div>

    <div class="panel right">
      <h2 style="margin-top:0">Store</h2>
      <div class="store" id="store">
        <!-- items dynamically inserted -->
      </div>

  <h2 style="margin-top:14px">Parannukset</h2>
      <div class="store" id="upgrades"></div>

      <div style="margin-top:12px;color:var(--muted);font-size:13px">Vinkki: osta hiiriä passiivisiin kekseihin. Hinnat kasvavat omistamiesi määrän mukaan.</div>
    </div>
  </div>

  <script>
  // Yksinkertaiset Keksiklikkeri-mekaniikat
    const storageKey = 'mini-cookie-save-v1'
    const cookieEl = document.getElementById('cookie')
    const cookiesDisplay = document.getElementById('cookiesDisplay')
    const cookiesShort = document.getElementById('cookiesShort')
    const cpsEl = document.getElementById('cps')
    const cpcEl = document.getElementById('cpc')
    const storeEl = document.getElementById('store')
    const upgradesEl = document.getElementById('upgrades')
    const saveBtn = document.getElementById('saveBtn')
    const resetBtn = document.getElementById('resetBtn')

    let state = {
      cookies: 0,
      totalCookies: 0,
      cpc: 1, // keksit per napsautus
      cps: 0, // keksit per sekunti (passiivinen)
      items: {
        cursor: 0
      },
      lastTick: Date.now()
    }

    const storeItems = [
      {
        id: 'cursor',
        name: 'Hiiri',
        baseCost: 15,
        cps: 0.1,
        desc: 'Pieni automaattinen napsautus.'
      }
    ]

    const upgrades = [
      {
        id: 'handy-gloves',
        name: 'Kätevät käsineet',
        cost: 150,
        apply: s => { s.cpc *= 2 }
      }
    ]

    function format(n){
      if (n >= 1e9) return (n/1e9).toFixed(2)+'B'
      if (n >= 1e6) return (n/1e6).toFixed(2)+'M'
      if (n >= 1e3) return (n/1e3).toFixed(2)+'k'
      return Math.floor(n)
    }

    function calcCosts(itemId){
      const info = storeItems.find(i=>i.id===itemId)
      const owned = state.items[itemId] || 0
      // exponential cost scaling
      return Math.ceil(info.baseCost * Math.pow(1.15, owned))
    }

    function renderStore(){
      storeEl.innerHTML = ''
      for (const it of storeItems){
        const cost = calcCosts(it.id)
        const row = document.createElement('div')
        row.className = 'item'
        row.innerHTML = `<div style="min-width:0"><strong>${it.name}</strong><div style="color:var(--muted);font-size:13px">${it.desc}</div></div><div style="text-align:right">Määrä: <strong>${state.items[it.id]||0}</strong><div style="margin-top:6px"><button class=\"btn\" data-buy=\"${it.id}\">Osta (${cost})</button></div></div>`
        storeEl.appendChild(row)
      }
      storeEl.querySelectorAll('[data-buy]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          buyItem(btn.getAttribute('data-buy'))
        })
      })
    }

    function renderUpgrades(){
      upgradesEl.innerHTML = ''
      for (const up of upgrades){
        const row = document.createElement('div')
        row.className = 'item'
        row.innerHTML = `<div><strong>${up.name}</strong><div style="color:var(--muted);font-size:13px">Kertaluonteinen parannus</div></div><div style="text-align:right"><div style="margin-top:6px"><button class=\"btn\" data-up=\"${up.id}\">Osta (${up.cost})</button></div></div>`
        upgradesEl.appendChild(row)
      }
      upgradesEl.querySelectorAll('[data-up]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          buyUpgrade(btn.getAttribute('data-up'))
        })
      })
    }

    function buyItem(id){
      const cost = calcCosts(id)
      if (state.cookies >= cost){
        state.cookies -= cost
        state.items[id] = (state.items[id]||0) + 1
        recalcCPS()
        // Re-render store and stats so costs and owned counts update
        renderAll()
      } else {
        flash("Ei tarpeeksi keksejä")
      }
    }

    function buyUpgrade(id){
      const up = upgrades.find(u=>u.id===id)
      if (!up) return
      if (state.cookies >= up.cost){
        state.cookies -= up.cost
        up.apply(state)
        // remove upgrade so it can't be bought again
        const idx = upgrades.findIndex(x=>x.id===id)
        if (idx>=0) upgrades.splice(idx,1)
        recalcCPS()
        // Re-render UI so upgrade list and stats update
        renderAll()
      } else flash('Not enough cookies')
    }

    function recalcCPS(){
      let cps = 0
      for (const it of storeItems){
        const owned = state.items[it.id] || 0
        cps += owned * it.cps
      }
      state.cps = +cps.toFixed(4)
    }

    function tickRender(){
      cookiesDisplay.textContent = Math.floor(state.cookies)
      cookiesShort.textContent = format(state.cookies)
      cpsEl.textContent = state.cps.toFixed(2)
      cpcEl.textContent = state.cpc.toFixed(2)
    }

    function clickCookie(){
      state.cookies += state.cpc
      state.totalCookies += state.cpc
      animateCookie()
      tickRender()
    }

    function animateCookie(){
      cookieEl.style.transform = 'scale(0.97)'
      setTimeout(()=>cookieEl.style.transform = '', 100)
    }

    // passive ticks
    function loop(){
      const now = Date.now()
      const dt = (now - state.lastTick)/1000
      state.lastTick = now
      state.cookies += state.cps * dt
      // small rounding
      if (state.cookies > 1e12) state.cookies = Math.floor(state.cookies)
      tickRender()
    }

    // save/load
    function save(){
      const copy = JSON.parse(JSON.stringify(state))
      localStorage.setItem(storageKey, JSON.stringify(copy))
      flash('Tallennettu')
    }

    function load(){
      const raw = localStorage.getItem(storageKey)
      if (!raw) return
      try{
        const s = JSON.parse(raw)
        // merge only known fields (simple migration-friendly approach)
        state.cookies = s.cookies||0
        state.totalCookies = s.totalCookies||0
        state.cpc = s.cpc||1
        state.cps = s.cps||0
        state.items = s.items || {cursor:0}
      }catch(e){console.warn('Failed to load save',e)}
      recalcCPS()
    }

    function reset(){
      if (!confirm('Haluatko nollata tallennuksen?')) return
      localStorage.removeItem(storageKey)
      state = {cookies:0,totalCookies:0,cpc:1,cps:0,items:{cursor:0},lastTick:Date.now()}
      recalcCPS()
      renderAll()
    }

    function flash(msg){
      // small temporary status overlay
      const el = document.createElement('div')
  el.textContent = msg
      el.style.position='fixed'
      el.style.left='50%'
      el.style.transform='translateX(-50%)'
      el.style.bottom='30px'
      el.style.background='rgba(0,0,0,0.6)'
      el.style.padding='8px 12px'
      el.style.borderRadius='8px'
      el.style.color='white'
      el.style.zIndex='9999'
      document.body.appendChild(el)
      setTimeout(()=>el.remove(),900)
    }

    // alusta käyttöliittymä
    function renderAll(){
      renderStore()
      renderUpgrades()
      tickRender()
    }

    // keyboard support
    window.addEventListener('keydown', (e)=>{
      if (e.code === 'Space'){
        e.preventDefault()
        clickCookie()
      }
    })

    cookieEl.addEventListener('click', clickCookie)
  saveBtn.addEventListener('click', save)
  resetBtn.addEventListener('click', reset)

    // periodic autosave and game loop
    load()
    recalcCPS()
    renderAll()
    state.lastTick = Date.now()
    setInterval(loop, 100) // 10fps loop for smooth passive gains
    setInterval(()=>{ save() }, 5000)
    window.addEventListener('beforeunload', save)

  </script>
</body>
</html>
